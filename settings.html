<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Support Tickets | Settings</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-layout">
    <aside id="sidebar" class="sidebar"></aside>

    <main class="main-content">
      <div class="main-card">
<div class="card-header">
  <h1>Settings</h1>
  <button id="logoutButton" class="btn-logout-top">Logout</button>
</div>

        <div id="siteMsg" class="msg hidden"></div>
        <div id="siteErr" class="err hidden"></div>

        <h2>Website</h2>
        <form id="siteForm">
          <label>Website name (browser tab)
            <input type="text" id="siteName">
          </label>

          <label>Favicon / logo path
            <input type="text" id="faviconPath">
          </label>

          <p style="font-size:12px; color:#6b7280;">
            Example: <code>favicon.ico</code> or <code>images/logo.png</code>.  
            Make sure the file exists on your hosting.
          </p>

          <button type="submit">Save Website Settings</button>
        </form>

        <hr>

        <div id="userMsg" class="msg hidden"></div>
        <div id="userErr" class="err hidden"></div>

        <h2>Users</h2>

        <h3>Create new user</h3>
        <form id="userForm">
          <label>Username
            <input type="text" id="newUsername" required>
          </label>

          <label>Password
            <input type="password" id="newPassword" required>
          </label>

          <label>Role
            <select id="newRole">
              <option value="customer">Customer</option>
              <option value="admin">Admin</option>
            </select>
          </label>

          <button type="submit">Create User</button>
        </form>

        <h3>Existing users</h3>
        <table id="usersTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Role</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>
  </div>

  <script src="app.js"></script>
  <script>
    function showSiteMsg(text, isError = false) {
      const msg = document.getElementById('siteMsg');
      const err = document.getElementById('siteErr');
      msg.classList.add('hidden');
      err.classList.add('hidden');
      if (isError) {
        err.textContent = text;
        err.classList.remove('hidden');
      } else {
        msg.textContent = text;
        msg.classList.remove('hidden');
      }
    }

    function showUserMsg(text, isError = false) {
      const msg = document.getElementById('userMsg');
      const err = document.getElementById('userErr');
      msg.classList.add('hidden');
      err.classList.add('hidden');
      if (isError) {
        err.textContent = text;
        err.classList.remove('hidden');
      } else {
        msg.textContent = text;
        msg.classList.remove('hidden');
      }
    }

    async function loadSiteSettingsForm() {
      try {
        const data = await apiFetch('/settings', { method: 'GET' });
        document.getElementById('siteName').value = data.site_name || '';
        document.getElementById('faviconPath').value = data.favicon || '';
      } catch (err) {
        console.error(err);
        showSiteMsg('Failed to load site settings.', true);
      }
    }

    async function loadUsersTable() {
      try {
        const users = await apiFetch('/users', { method: 'GET' });
        const tbody = document.querySelector('#usersTable tbody');
        tbody.innerHTML = '';

        users.forEach(u => {
          const tr = document.createElement('tr');

          const tdId = document.createElement('td');
          tdId.textContent = u.id;
          tr.appendChild(tdId);

          const tdName = document.createElement('td');
          tdNa
